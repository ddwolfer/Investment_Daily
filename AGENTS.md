# AI å”ä½œæŒ‡å¼• (Agent Collaboration Guide)

æœ¬å°ˆæ¡ˆä½¿ç”¨ AI è¼”åŠ©é–‹ç™¼ï¼Œä»¥ä¸‹æ˜¯å”ä½œæ™‚çš„é‡è¦è¦å‰‡èˆ‡æ–‡ä»¶å°è¦½ã€‚

---

## ğŸ“š å°ˆæ¡ˆæ–‡ä»¶å°è¦½

è«‹åœ¨å”ä½œæ™‚**å„ªå…ˆé–±è®€**ä»¥ä¸‹æ–‡ä»¶ä»¥ç†è§£å°ˆæ¡ˆæ¶æ§‹èˆ‡ç•¶å‰ç‹€æ…‹ï¼š

### æ ¸å¿ƒæ–‡ä»¶ï¼ˆå¿…è®€ï¼‰

| æª”æ¡ˆ | ç”¨é€” | ä½•æ™‚æŸ¥çœ‹ |
|------|------|---------|
| **`README.md`** | å°ˆæ¡ˆæ¦‚è¿°ã€å®‰è£æŒ‡å—ã€ä½¿ç”¨æ–¹å¼ | åˆæ¬¡æ¥è§¸å°ˆæ¡ˆæ™‚ |
| **`spec.md`** | å®Œæ•´æŠ€è¡“è¦æ ¼ã€æ¨¡çµ„è¨­è¨ˆã€API è¦ç¯„ | é–‹ç™¼æ–°åŠŸèƒ½å‰ |
| **`TODO.md`** | ç•¶å‰å¾…è¾¦äº‹é …ã€å„ªå…ˆç´šã€å·²å®ŒæˆåŠŸèƒ½ | æ¯æ¬¡é–‹ç™¼å‰ |
| **`pyproject.toml`** | ä¾è³´ç®¡ç†ã€å°ˆæ¡ˆé…ç½®ã€æ‰“åŒ…è¨­å®š | éœ€è¦æ–°å¢å¥—ä»¶æ™‚ |

### è¨­è¨ˆæ–‡ä»¶ï¼ˆæ·±å…¥ç†è§£ï¼‰

| æª”æ¡ˆ | ç”¨é€” | ä½•æ™‚æŸ¥çœ‹ |
|------|------|---------|
| **`project_context.md`** | å°ˆæ¡ˆèƒŒæ™¯ã€ä½¿ç”¨è€…éœ€æ±‚ã€è¨­è¨ˆç†å¿µ | éœ€è¦ç†è§£ã€Œç‚ºä»€éº¼ã€é€™æ¨£è¨­è¨ˆæ™‚ |
| **`design_storage.md`** | æœ¬åœ°å„²å­˜æ¶æ§‹è¨­è¨ˆæ–‡ä»¶ | ä¿®æ”¹è³‡æ–™åº«æˆ–å¿«å–é‚è¼¯æ™‚ |

### é–‹ç™¼è¼”åŠ©ï¼ˆé™¤éŒ¯å¿…çœ‹ï¼‰

| æª”æ¡ˆ | ç”¨é€” | ä½•æ™‚æŸ¥çœ‹ |
|------|------|---------|
| **`error_log.md`** | å·²è§£æ±ºçš„æŠ€è¡“å•é¡Œã€æ ¹æœ¬åŸå› åˆ†æ | é‡åˆ°é¡ä¼¼éŒ¯èª¤æ™‚ |

---

## ğŸ’» ä»£ç¢¼é¢¨æ ¼è¦ç¯„

### èªè¨€èˆ‡ç·¨ç¢¼
- **è¨»è§£èˆ‡æ–‡æª”å­—ä¸²**ï¼šä½¿ç”¨**ç¹é«”ä¸­æ–‡**
- **è®Šæ•¸èˆ‡å‡½æ•¸å‘½å**ï¼šè‹±æ–‡ snake_caseï¼ˆä¾‹å¦‚ï¼š`get_portfolio_data`ï¼‰
- **æª”æ¡ˆç·¨ç¢¼**ï¼šUTF-8ï¼ˆ**ä¸ä½¿ç”¨ BOM**ï¼‰
- **æ›è¡Œç¬¦è™Ÿ**ï¼šLFï¼ˆUnix é¢¨æ ¼ï¼‰
  - âš ï¸ Windows ç’°å¢ƒæ³¨æ„ï¼šGit æœƒè‡ªå‹•è™•ç† CRLF â†” LF è½‰æ›

### Python ä»£ç¢¼æ…£ä¾‹
```python
# âœ… æ¨è–¦å¯«æ³•
def get_market_data(symbol: str, asset_type: str) -> pd.DataFrame:
    """
    ç²å–å¸‚å ´æ•¸æ“šï¼ˆæ”¯æ´ç¾è‚¡èˆ‡åŠ å¯†è²¨å¹£ï¼‰
    
    Args:
        symbol: è‚¡ç¥¨æˆ–å¹£ç¨®ä»£ç¢¼ï¼ˆä¾‹å¦‚ï¼šTSLA, BTCï¼‰
        asset_type: è³‡ç”¢é¡å‹ï¼ˆ'Stock' æˆ– 'Crypto'ï¼‰
    
    Returns:
        pandas.DataFrame: OHLCV æ•¸æ“šï¼Œå¤±æ•—æ™‚è¿”å›ç©º DataFrame
    """
    try:
        # å¯¦ä½œé‚è¼¯
        pass
    except Exception as e:
        print(f"ç²å–æ•¸æ“šå¤±æ•— {symbol}: {e}")
        return pd.DataFrame()
```

### é¡å‹æç¤º
- **å»ºè­°ä½†éå¼·åˆ¶**ä½¿ç”¨ Python é¡å‹æç¤ºï¼ˆType Hintsï¼‰
- å°æ–¼å…¬é–‹ API çš„å‡½æ•¸ï¼Œå»ºè­°åŠ ä¸Šåƒæ•¸èˆ‡è¿”å›å€¼çš„é¡å‹

---

## ğŸ—‚ï¸ å°ˆæ¡ˆæ¶æ§‹åŸå‰‡

### æ¨¡çµ„è·è²¬åŠƒåˆ†

```
investment_bot/
â”œâ”€â”€ config.py          # åªè² è²¬é…ç½®ï¼Œä¸åŒ…å«æ¥­å‹™é‚è¼¯
â”œâ”€â”€ main.py            # åªè² è²¬æµç¨‹ç·¨æ’ï¼Œä¸å¯¦ä½œå…·é«”åŠŸèƒ½
â”œâ”€â”€ services/          # æ¥­å‹™é‚è¼¯å±¤ï¼ˆå¤–éƒ¨ API æ•´åˆï¼‰
â”‚   â”œâ”€â”€ google_sheet.py    # Google Sheets API
â”‚   â”œâ”€â”€ market_data.py     # å¸‚å ´æ•¸æ“š API (yfinance, ccxt)
â”‚   â”œâ”€â”€ tech_analysis.py   # æŠ€è¡“åˆ†æè¨ˆç®—
â”‚   â”œâ”€â”€ llm_analyzer.py    # LLM API (Gemini)
â”‚   â””â”€â”€ telegram_bot.py    # Telegram API
â””â”€â”€ utils/             # å·¥å…·å±¤ï¼ˆå…±ç”¨åŠŸèƒ½ï¼‰
    â”œâ”€â”€ data_store.py      # çµ±ä¸€çš„æ•¸æ“šå­˜å–ä»‹é¢
    â”œâ”€â”€ db_manager.py      # SQLite è³‡æ–™åº«ç®¡ç†
    â””â”€â”€ formatters.py      # æ ¼å¼åŒ–å·¥å…·
```

### è¨­è¨ˆæ¨¡å¼
- **Facade Pattern**ï¼š`DataStore` æä¾›çµ±ä¸€ä»‹é¢ï¼Œéš±è— SQLite å’Œ Parquet çš„è¤‡é›œæ€§
- **Cache-Aside Pattern**ï¼šå…ˆæŸ¥å¿«å–ï¼Œmiss æ™‚æ‰å‘¼å« APIï¼Œç„¶å¾Œæ›´æ–°å¿«å–
- **Service Layer Pattern**ï¼šæ¯å€‹å¤–éƒ¨ API å°è£æˆç¨ç«‹æœå‹™

---

## ğŸ”§ é–‹ç™¼å·¥ä½œæµç¨‹

### æ–°å¢åŠŸèƒ½æ™‚

1. **æŸ¥çœ‹ `TODO.md`** ç¢ºèªå„ªå…ˆç´š
2. **é–±è®€ `spec.md`** ç†è§£æ¨¡çµ„è·è²¬
3. **å¯¦ä½œä»£ç¢¼**ï¼ˆéµå¾ªé¢¨æ ¼è¦ç¯„ï¼‰
4. **æ’°å¯«æ¸¬è©¦**ï¼ˆåœ¨ `test_script/` ä¸­ï¼‰
5. **æ›´æ–° `TODO.md`** æ¨™è¨˜å®Œæˆ
6. **Git Commit**ï¼ˆéµå¾ª Commit è¦ç¯„ï¼‰

### é‡åˆ°éŒ¯èª¤æ™‚

1. **æŸ¥çœ‹ `error_log.md`** æ˜¯å¦æœ‰é¡ä¼¼å•é¡Œ
2. **è§£æ±ºå•é¡Œ**
3. **æ›´æ–° `error_log.md`**ï¼Œè¨˜éŒ„ï¼š
   - éŒ¯èª¤è¨Šæ¯
   - æ ¹æœ¬åŸå› ï¼ˆæŠ€è¡“å±¤é¢ï¼‰
   - è§£æ±ºæ–¹æ¡ˆ
   - å­¸ç¿’é»

---

## ğŸ“ Git Commit è¦ç¯„

### Commit Message æ ¼å¼

**æœ¬å°ˆæ¡ˆä½¿ç”¨ç¹é«”ä¸­æ–‡æ’°å¯« commit message**

```
<é¡å‹>: <ç°¡çŸ­æè¿°>

[å¯é¸çš„è©³ç´°èªªæ˜]
```

### é¡å‹ (Type)

| é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| `æ–°å¢` | æ–°åŠŸèƒ½é–‹ç™¼ | `æ–°å¢: æ”¯æ´ Telegram é€šçŸ¥æ¨é€` |
| `ä¿®æ­£` | Bug ä¿®å¾© | `ä¿®æ­£: è™•ç†æŒå€‰æ•¸æ“šç‚º None çš„æƒ…æ³` |
| `æ–‡ä»¶` | æ–‡ä»¶æ›´æ–° | `æ–‡ä»¶: æ›´æ–° README åŠ å…¥æœ¬åœ°å„²å­˜æ¶æ§‹èªªæ˜` |
| `æ¸¬è©¦` | æ¸¬è©¦ç›¸é—œ | `æ¸¬è©¦: æ–°å¢å¸‚å ´æ•¸æ“š API æ•´åˆæ¸¬è©¦` |
| `é‡æ§‹` | ä»£ç¢¼é‡æ§‹ | `é‡æ§‹: æå–å…±ç”¨é‚è¼¯åˆ° utils æ¨¡çµ„` |
| `ç¶­è­·` | ä¾è³´æ›´æ–°ã€é…ç½®èª¿æ•´ | `ç¶­è­·: æ›´æ–°å°ˆæ¡ˆä¾è³´å¥—ä»¶ç‰ˆæœ¬` |
| `å„ªåŒ–` | æ€§èƒ½å„ªåŒ– | `å„ªåŒ–: æ”¹å–„è³‡æ–™åº«æŸ¥è©¢æ•ˆç‡` |

### ç¯„ä¾‹

```bash
# âœ… å¥½çš„ commitï¼ˆç¹é«”ä¸­æ–‡ï¼‰
æ–°å¢: æ”¯æ´é›™ Google Sheet è®€å–ï¼ˆç¾è‚¡ + åŠ å¯†è²¨å¹£ï¼‰

# è©³ç´°èªªæ˜
- æ–°å¢ GOOGLE_SHEET_ID_STOCK èˆ‡ GOOGLE_SHEET_ID_CRYPTO é…ç½®
- é‡æ§‹ GoogleSheetService æ”¯æ´é›™ä¾†æºæ•¸æ“šè®€å–
- æ›´æ–°æ¸¬è©¦è…³æœ¬é©—è­‰é›™ä¾†æºåŠŸèƒ½
- ä¿®æ­£ä¸­è‹±æ–‡æ¬„ä½åç¨±å°æ˜ èˆ‡ç™¾åˆ†æ¯”æ ¼å¼è½‰æ›

æ¸¬è©¦çµæœï¼šæˆåŠŸè®€å– 8 æª”ç¾è‚¡ + 7 å€‹åŠ å¯†è²¨å¹£ = 15 å€‹æŒå€‰
```

```bash
# âœ… å¦ä¸€å€‹ç¯„ä¾‹
æ–‡ä»¶: æ–°å¢ AGENTS.md èˆ‡æ›´æ–° README

- æ–°å¢ Cursor Agent å”ä½œè¦å‰‡æª”æ¡ˆï¼ˆAGENTS.mdï¼‰
- æ–°å¢è©³ç´°çš„é–‹ç™¼å¾…è¾¦æ¸…å–®ï¼ˆTODO.mdï¼‰
- æ›´æ–° README åŠ å…¥å®Œæ•´å®‰è£æŒ‡å—èˆ‡ FAQ
- è£œå……å°ˆæ¡ˆæ¶æ§‹èªªæ˜èˆ‡æŠ€è¡“æ£§æ¸…å–®
```

### è‹±æ–‡ç‰ˆæœ¬ï¼ˆåƒè€ƒç”¨ï¼‰

å¦‚æœéœ€è¦èˆ‡åœ‹éš›åœ˜éšŠå”ä½œï¼Œå¯ä»¥ä½¿ç”¨è‹±æ–‡ç‰ˆæœ¬ï¼š

| Type | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| `feat` | æ–°åŠŸèƒ½ | `feat: add telegram notification` |
| `fix` | Bug ä¿®å¾© | `fix: handle None value in portfolio data` |
| `docs` | æ–‡ä»¶æ›´æ–° | `docs: update README with storage architecture` |
| `test` | æ¸¬è©¦ç›¸é—œ | `test: add market data API integration test` |
| `refactor` | é‡æ§‹ | `refactor: extract common logic to utils` |
| `chore` | é›œé … | `chore: update dependencies` |
| `perf` | æ€§èƒ½å„ªåŒ– | `perf: optimize database query` |

---

## ğŸ›¡ï¸ éŒ¯èª¤è™•ç†åŸå‰‡

### API èª¿ç”¨

```python
# âœ… æ¨è–¦å¯«æ³•
try:
    data = api.fetch_data(symbol)
    if not data:
        print(f"è­¦å‘Šï¼š{symbol} ç„¡æ•¸æ“š")
        return default_value
except RateLimitError:
    print(f"API Rate Limitï¼Œç¨å¾Œé‡è©¦")
    time.sleep(60)
    return retry_fetch(symbol)
except Exception as e:
    print(f"API èª¿ç”¨å¤±æ•— {symbol}: {e}")
    return default_value
```

### è³‡æ–™é©—è­‰

```python
# âœ… æ¨è–¦å¯«æ³•
if df.empty:
    print(f"è­¦å‘Šï¼š{symbol} DataFrame ç‚ºç©º")
    return pd.DataFrame()

if 'Close' not in df.columns:
    print(f"éŒ¯èª¤ï¼šç¼ºå°‘ Close æ¬„ä½")
    return pd.DataFrame()
```

---

## ğŸ” å®‰å…¨æ€§åŸå‰‡

### æ•æ„Ÿè³‡æ–™ä¿è­·

**çµ•å°ä¸å¯ç´å…¥ç‰ˆæ§**ï¼š
- âŒ `.env` æª”æ¡ˆ
- âŒ `credentials.json`ï¼ˆGoogle Service Account Keyï¼‰
- âŒ API Keys æˆ– Tokens
- âŒ çœŸå¯¦çš„ Sheet IDï¼ˆåœ¨æ–‡ä»¶ä¸­ä½¿ç”¨ç¯„ä¾‹å€¼ï¼‰

**å·²åœ¨ `.gitignore` ä¸­æ’é™¤**ï¼š
- `.env`, `credentials.json`
- `investment_bot/data/`ï¼ˆæœ¬åœ°è³‡æ–™åº«èˆ‡å¿«å–ï¼‰
- `*.db`, `*.parquet`

### éŒ¯èª¤è¨Šæ¯è¼¸å‡º

```python
# âœ… å®‰å…¨ï¼šä¸æ´©æ¼æ•æ„Ÿè³‡è¨Š
print(f"ç„¡æ³•é€£æ¥åˆ° Google Sheet")

# âŒ å±éšªï¼šå¯èƒ½æ´©æ¼ API Key
print(f"API Error: {full_response_with_key}")
```

---

## ğŸ§ª æ¸¬è©¦åŸå‰‡

### æ¸¬è©¦æª”æ¡ˆä½ç½®
æ‰€æœ‰æ¸¬è©¦è…³æœ¬æ”¾åœ¨ `test_script/` ç›®éŒ„ï¼š
- `test_gemini.py` - Gemini API æ¸¬è©¦
- `test_storage.py` - æœ¬åœ°å„²å­˜æ•´åˆæ¸¬è©¦
- `debug_google_sheet.py` - Google Sheet é€£ç·šé™¤éŒ¯

### æ¸¬è©¦æ’°å¯«è¦ç¯„

```python
# test_script/test_xxx.py

def test_feature():
    """æ¸¬è©¦åŠŸèƒ½æè¿°"""
    print("=== æ¸¬è©¦ï¼šåŠŸèƒ½åç¨± ===")
    
    # æº–å‚™æ¸¬è©¦æ•¸æ“š
    test_data = ...
    
    # åŸ·è¡Œæ¸¬è©¦
    result = function_to_test(test_data)
    
    # é©—è­‰çµæœ
    if result == expected:
        print("âœ… æ¸¬è©¦é€šé")
    else:
        print(f"âŒ æ¸¬è©¦å¤±æ•—ï¼šé æœŸ {expected}ï¼Œå¯¦éš› {result}")

if __name__ == "__main__":
    test_feature()
```

---

## ğŸ¯ AI å”ä½œæç¤º

### é–‹å§‹æ–°ä»»å‹™æ™‚
1. é–±è®€ `TODO.md` äº†è§£ç•¶å‰å„ªå…ˆç´š
2. æŸ¥çœ‹ `spec.md` ç†è§£æ¨¡çµ„è¨­è¨ˆ
3. æª¢æŸ¥ `error_log.md` é¿å…é‡è¤‡å•é¡Œ

### åšè¨­è¨ˆæ±ºç­–æ™‚
- å„ªå…ˆè€ƒæ…®**ç°¡å–®æ€§** > å®Œç¾æ€§
- API èª¿ç”¨å¿…é ˆåŠ å¿«å–
- éŒ¯èª¤è™•ç†è¦å„ªé›…é™ç´šï¼ˆGraceful Degradationï¼‰

### å®Œæˆä»»å‹™å¾Œ
- æ›´æ–° `TODO.md` æ¨™è¨˜å®Œæˆ
- å¦‚æœé‡åˆ°éŒ¯èª¤ï¼Œè¨˜éŒ„åˆ° `error_log.md`
- æ’°å¯«æ¸…æ™°çš„ commit message

---

## ğŸ“Œ é‡è¦æé†’

### Windows ç’°å¢ƒç‰¹æ®Šè™•ç†
```powershell
# åŸ·è¡Œ Python ç¨‹å¼æ™‚éœ€è¦è¨­å®š UTF-8
$env:PYTHONUTF8=1; uv run python -m investment_bot.main
```

### uv æŒ‡ä»¤é€ŸæŸ¥
```bash
uv sync                    # å®‰è£ä¾è³´ï¼ˆæ ¹æ“š uv.lockï¼‰
uv add package>=version    # æ–°å¢å¥—ä»¶
uv remove package          # ç§»é™¤å¥—ä»¶
uv run python script.py    # åœ¨è™›æ“¬ç’°å¢ƒä¸­åŸ·è¡Œ
```

### å¿«å–æ¸…é™¤ï¼ˆé™¤éŒ¯ç”¨ï¼‰
```bash
# æ¸…é™¤æ‰€æœ‰å¿«å–èˆ‡è³‡æ–™åº«
rm -r investment_bot/data/
```

---

**ğŸ“… æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.0  
**ğŸ”„ æœ€å¾Œæ›´æ–°**ï¼š2025-12-12

